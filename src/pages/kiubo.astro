---
import '@fontsource-variable/alexandria';
import Layout from '../layouts/Layout.astro';
import kiuboPrimera from '../assets/kiuboPrimera.png';
import logoUno from '../assets/logoUno.png';
import logoDos from '../assets/logoDos.png';
import logoTres from '../assets/logoTres.png';
import ideacion from '../assets/ideacion.png';
import mockUno from '../assets/mockUno.png';
import mockDos from '../assets/mockDos.png';
import primeraMock from '../assets/primeraDisenoKiubo.png';
import segundaMock from '../assets/segundaDisenoKiubo.png';
import terceraMock from '../assets/terceraDisenoKiubo.png';
import Footer from "../components/footer.astro";
---

<Layout title="Proyecto Kiubo">
  <section class="page-container">
    <div class="defectoSection fade-in-on-scroll">
        <h2>Kiubo</h2>
        <p>Crear una app que facilite la comunicacion entre vecinos para compartir servicios y eventos locales.</p>
    </div>

    <div class="image-section fade-in-on-scroll">
        <img src={kiuboPrimera.src} alt="Kiubo" class="kiubo-image"/>
    </div>

    <div class="split-section fade-in-on-scroll">
      <div class="text-content">
        <p>
          Más del 40% de las mujeres experimentan soledad por factores como la viudez, la dependencia económica, el envejecimiento o la partida de los hijos. Esta soledad impacta su salud física y mental, aumentando el riesgo de depresión, ansiedad y enfermedades cardiovasculares.El desafío: mejorar el bienestar emocional y la conexión social de las mujeres para fortalecer su calidad de vida.
        </p>
      </div>
      <div class="percentage-content">
        <svg viewBox="0 0 200 100" preserveAspectRatio="xMidYMid meet">
          <text x="50%" y="50%">40%</text>
        </svg>
      </div>
    </div>

    <div class="defectoSection fade-in-on-scroll">
        <h2>Investigación</h2>
        <p>Buscar referentes al crear una aplicación permite inspirarse en experiencias exitosas, evitar errores y aprovechar tendencias. Además, ayuda a anticipar la competencia y definir una estrategia sólida. No se trata de copiar, sino de adaptar y reinterpretar lo mejor para responder a las necesidades del público objetivo.</p>
    </div>

    <div class="logos-section fade-in-on-scroll">
      <div class="logo-wrapper">
        <img src={logoUno.src} alt="Logo de referencia uno" class="logo-image"/>
      </div>
      <div class="logo-wrapper">
        <img src={logoDos.src} alt="Logo de referencia dos" class="logo-image"/>
      </div>
      <div class="logo-wrapper">
        <img src={logoTres.src} alt="Logo de referencia tres" class="logo-image"/>
      </div>
    </div>

    <div class="defectoSection fade-in-on-scroll">
        <h2>Ideación y estructura</h2>
    </div>

    <div class="image-section image-section-interactive fade-in-on-scroll">
        <p class="interaction-prompt"></p>
        <div id="magnifier-lens"></div>
        <img src={ideacion.src} alt="Mapa de ideación y estructura del proyecto" class="kiubo-image interactive-image" id="ideacionImage"/>
    </div>
    <div class="defectoSection fade-in-on-scroll">
        <h2>Diseño visual</h2>
    </div>
    <div class="mockups-sectionUno circulo-difuminado fade-in-on-scroll">
      <img src={primeraMock.src} alt="Mockup de la aplicación 1" class="mockup-image"/>
    </div>
     <div class="mockups-sectionDos fade-in-on-scroll">
      <img src={mockUno.src} alt="Mockup de la aplicación 2" class="mockup-image"/>
      <img src={mockDos.src} alt="Mockup de la aplicación 3" class="mockup-image"/>
    </div>
     <div class="mockups-sectionUno fade-in-on-scroll">
      <img src={segundaMock.src} alt="Mockup de la aplicación 4" class="mockup-image"/>
    </div>
    
      <div class="defectoSection fade-in-on-scroll">
        <p>explicar un poco sobre lo que trata el boton de emergencia Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula</p>
      </div>
       <div class="mockups-sectionUno circulo-difuminado fade-in-on-scroll">
      <img src={terceraMock.src} alt="Mockup de la aplicación 5" class="mockup-image"/>
    </div>
      </section>

  <div id="imageModal" class="modal">
    <span class="close-modal">&times;</span>
    <img class="modal-content" id="modalImageContent">
  </div>
   <Footer />
</Layout>


<style>
/* --- CÓDIGO AÑADIDO PARA LA ANIMACIÓN --- */
  .fade-in-on-scroll {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }
  .fade-in-on-scroll.is-visible {
    opacity: 1;
    transform: translateY(0);
  }
/* --- FIN DEL CÓDIGO AÑADIDO --- */

  .defectoSection {
    font-family: 'Alexandria Variable', sans-serif;
    color: white;
    text-align: left; 
    padding: 2rem 1rem; 
    max-width: 80%; 
    margin: 0 auto; 
  }

  .defectoSection h2 {
    font-size: clamp(2.5rem, 5vw, 4rem);
    margin-bottom: 1rem;
  }

  .defectoSection p {
    font-size: clamp(1rem, 2vw, 1.3rem);
    line-height: 1.6;
  }
  
  .interaction-prompt {
    text-align: center;
    color: #aaa;
    margin-bottom: 5px;
    font-size: 15px;
    height: 1.2em;
  }

  .image-section {
    display: flex; 
    flex-direction: column;
    justify-content: center; 
    align-items: center; 
    padding: 2rem 1rem; 
  }

  .image-section-interactive {
    position: relative;
    overflow: hidden;
  }

  #magnifier-lens {
    display: none;
    position: absolute;
    border: 2px solid white;
    border-radius: 50%;
    width: 400px;
    height: 400px;
    pointer-events: none;
    z-index: 10;
  }

  .kiubo-image {
    display: block; 
    max-width: 80%; 
    height: auto; 
    margin: 0 auto; 
    border-radius: 15px; 
  }

  .interactive-image {
    cursor: pointer;
    transition: transform 0.3s ease-in-out;
  }
  .interactive-image:hover {
    transform: scale(1.05);
  }

  .split-section {
    font-family: 'Alexandria Variable', sans-serif;
    color: white;
    display: flex;
    max-width: 80%;
    margin: 4rem auto;
    padding: 0 1rem;
    gap: 2rem;
    align-items: stretch;
  }

  .text-content {
    flex: 3;
    font-size: 1.1rem;
    line-height: 1.7;
  }

  .percentage-content {
    flex: 2;
  }
  
  .percentage-content svg {
    width: 100%;
    height: 100%;
  }

  .percentage-content text {
    font-family: 'Alexandria Variable', sans-serif;
    font-weight: bold;
    font-size: 80px;
    fill: white;
    text-anchor: middle;
    dominant-baseline: middle;
  }
  
  .logos-section {
    display: flex;
    justify-content: space-around;
    align-items: center;
    gap: 2rem;
    max-width: 80%;
    margin: 4rem auto;
    padding: 2rem 1rem;
  }

  .logo-wrapper {
    flex: 1;
    max-width: 200px;
  }

  .logo-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }
   .mockups-sectionUno {
    display: flex; 
    flex-direction: column;
    justify-content: center; 
    align-items: center; 
    padding: 0 1rem 80px;
  }
.circulo-difuminado {
  position: relative; 
  z-index: 1;
}

.circulo-difuminado::before {
  content: ''; 
  position: absolute; 
  width: 60%;
  height: 60%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #8E43F7CC;
  border-radius: 50%; 
  filter: blur(100px);
  z-index: -1; 
}

  .mockups-sectionDos {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 2rem;
    max-width: 80%;
    margin: 0 auto 4rem auto;
    padding: 0 1rem 80px;
  }

  .mockup-image {
    width: 60%;
    height: auto;
    border-radius: 15px;
  }

  .mockup-image:nth-child(odd) {
    justify-self: start;
  }

  .mockup-image:nth-child(even) {
    justify-self: end;
  }

  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.9);
    justify-content: center;
    align-items: center;
  }

  .modal.active {
    display: flex;
  }

  .modal-content {
    margin: auto;
    display: block;
    max-width: 85%;
    max-height: 85vh;
    border-radius: 15px;
  }

  .close-modal {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    transition: 0.3s;
    cursor: pointer;
    z-index: 1001;
  }
  .close-modal:hover {
    color: #bbb;
  }


  @media (max-width: 768px) {
    .defectoSection {
      max-width: 100%;
    }
    .kiubo-image {
      max-width: 100%; 
    }
    .split-section {
      flex-direction: column;
      max-width: 100%;
    }

    .percentage-content {
      order: -1;
    }

    .text-content {
      text-align: left;
    }

    .logos-section {
      max-width: 100%;
      gap: 1rem;
    }

    .mockups-section {
      grid-template-columns: 1fr;
      max-width: 100%;
    }
    
    .mockup-image {
        width: 100%;
    }

    .mockup-image:nth-child(odd),
    .mockup-image:nth-child(even) {
        justify-self: center;
    }

    .modal-content {
      width: 100%;
      height: 100%;
      max-width: 100vw;
      max-height: 100vh;
      object-fit: contain;
      border-radius: 0;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('imageModal');
    const imgToOpen = document.getElementById('ideacionImage');
    const modalImg = document.getElementById('modalImageContent');
    const closeBtn = document.querySelector('.close-modal');
    const prompt = document.querySelector('.interaction-prompt');

    const lens = document.getElementById('magnifier-lens');
    const imgContainer = imgToOpen ? imgToOpen.parentElement : null;

    let magnifyListenersAdded = false;

    const magnify = (e) => {
        const imgRect = imgToOpen.getBoundingClientRect();
        const containerRect = imgContainer.getBoundingClientRect();

        if (imgRect.width === 0 || imgRect.height === 0) return;
        
        let x = e.clientX - imgRect.left;
        let y = e.clientY - imgRect.top;

        if (x > imgRect.width) x = imgRect.width;
        if (x < 0) x = 0;
        if (y > imgRect.height) y = imgRect.height;
        if (y < 0) y = 0;
        
        lens.style.left = (e.clientX - containerRect.left - lens.offsetWidth / 2) + 'px';
        lens.style.top = (e.clientY - containerRect.top - lens.offsetHeight / 2) + 'px';

        const zoom = 2.5;
        const ratioX = imgToOpen.naturalWidth / imgRect.width;
        const ratioY = imgToOpen.naturalHeight / imgRect.height;
        
        lens.style.backgroundSize = `${imgToOpen.naturalWidth * zoom}px ${imgToOpen.naturalHeight * zoom}px`;
        
        const bgX = -(x * ratioX * zoom - lens.offsetWidth / 2);
        const bgY = -(y * ratioY * zoom - lens.offsetHeight / 2);
        
        lens.style.backgroundPosition = `${bgX}px ${bgY}px`;
    };

    const handleMouseEnter = () => { if(lens) lens.style.display = 'block'; };
    const handleMouseLeave = () => { if(lens) lens.style.display = 'none'; };
    
    const handleImageClick = function() {
        if (modal && modalImg) {
            modal.classList.add('active');
            modalImg.src = this.src;
            document.body.style.overflow = 'hidden';
        }
    }

    const setupInteractivity = () => {
        if (!imgToOpen || !prompt || !imgContainer) return;

        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        const isMobileWidth = window.innerWidth <= 728;

        if (isTouchDevice || isMobileWidth) {
            prompt.textContent = '¡Hazme tap!';
            imgToOpen.onclick = handleImageClick;
            imgToOpen.style.cursor = 'pointer';
            
            if (magnifyListenersAdded) {
                imgContainer.removeEventListener('mousemove', magnify);
                imgContainer.removeEventListener('mouseenter', handleMouseEnter);
                imgContainer.removeEventListener('mouseleave', handleMouseLeave);
                magnifyListenersAdded = false;
                if (lens) lens.style.display = 'none';
            }

        } else {
            prompt.textContent = 'Pasa el cursor para ampliar';
            imgToOpen.onclick = null;
            imgToOpen.style.cursor = 'none';
            
            if (!magnifyListenersAdded) {
                lens.style.backgroundImage = `url(${imgToOpen.src})`;
                imgContainer.addEventListener('mousemove', magnify);
                imgContainer.addEventListener('mouseenter', handleMouseEnter);
                imgContainer.addEventListener('mouseleave', handleMouseLeave);
                magnifyListenersAdded = true;
            }
        }
    };
    
    setupInteractivity();
    window.addEventListener('resize', setupInteractivity);
    
    if (modal && closeBtn) {
        const closeModal = function() {
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        closeBtn.onclick = closeModal;
        modal.onclick = function(event) {
            if (event.target === modal) {
                closeModal();
            }
        }
    }

    // --- CÓDIGO AÑADIDO PARA LA ANIMACIÓN DE SCROLL ---
    const observerOptions = {
      root: null,
      rootMargin: '0px',
      threshold: 0.1
    };

    const observerCallback = (entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          observer.unobserve(entry.target);
        }
      });
    };

    const observer = new IntersectionObserver(observerCallback, observerOptions);
    const elementsToAnimate = document.querySelectorAll('.fade-in-on-scroll');
    elementsToAnimate.forEach(element => {
      observer.observe(element);
    });
    // --- FIN DEL CÓDIGO AÑADIDO ---
  });
</script>